### Light controller main
substitutions:
  devicename: fl1_illuminatio
  upperDevicename: Floor1 Lights Controller
  # <<: !include ioMapping.yml
  <<: !include fl1SwitchMapping.yml

esphome:
  name: $devicename
  platform: ESP32
  board: esp32-poe

packages:
  # wifi: !include common/wifi.yml
  ethernet: !include common/ethernet.yml
  api: !include common/api.yml
  ota: !include common/ota.yml
  # mqtt: !include common/mqtt.yml
  logger: !include common/logger.yml
  time: !include common/time.yml
  webserver: !include common/webserver.yml

i2c:
  scan: True

# load module for PCF8574 Remote 8-Bit I/O Expanderfor I2C Bus
# datasheet https://www.ti.com/lit/ds/symlink/pcf8574.pdf
pcf8574:
  - id: 'pcf8574_1'
    address: 0x38
    pcf8575: False

  - id: 'pcf8574_2'
    address: 0x39
    pcf8575: False

  - id: 'pcf8574_3'
    address: 0x3A
    pcf8575: False

  - id: 'pcf8574_4'
    address: 0x3B
    pcf8575: False

  # - id: 'pcf8574_1'
  #   address: 0x20
  #   pcf8575: False

  # - id: 'pcf8574_2'
  #   address: 0x21
  #   pcf8575: False

  # - id: 'pcf8574_3'
  #   address: 0x22
  #   pcf8575: False

  # - id: 'pcf8574_4'
  #   address: 0x23
  #   pcf8575: False

# Individual outputs
switch:
  - platform: restart
    name: $upperDevicename Restart

# Temp sensor
sensor:
  - platform: bmp085
    temperature:
      name: "$upperDevicename enclosure Temperature"
    pressure:
      name: "$upperDevicename enclosure Pressure"
    update_interval: 300s
    
#   - platform: uptime
#     name: Uptime Sensor
#     id: uptime_sensor
#     update_interval: 60s
#     internal: true
#     on_raw_value:
#       then:
#         - text_sensor.template.publish:
#             id: uptime_human
#             state: !lambda |-
#               int seconds = round(id(uptime_sensor).raw_state);
#               int days = seconds / (24 * 3600);
#               seconds = seconds % (24 * 3600);
#               int hours = seconds / 3600;
#               seconds = seconds % 3600;
#               int minutes = seconds /  60;
#               seconds = seconds % 60;
#               return (
#                 (days ? String(days) + "d " : "") +
#                 (hours ? String(hours) + "h " : "") +
#                 (minutes ? String(minutes) + "m " : "") +
#                 (String(seconds) + "s")
#               ).c_str();

# text_sensor:
#   - platform: template
#     name: $upperDevicename Uptime Human Readable
#     id: uptime_human
#     icon: mdi:clock-start
              
# load module for PCA9685 16-Channel 12-bit PWM/Servo Driver I2C
# datasheet https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf
pca9685:
  - frequency: 500

#Define PCA9685 PWM chnnels and register them as outputs in ESPHome
# pins 0-15 are defined as channel 0-15
output:
  - platform: pca9685
    id: pca1_0
    channel: 0
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_1
    channel: 1
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_2
    channel: 2
    inverted: True

  - platform: pca9685
    id: pca1_3
    channel: 3
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_4
    channel: 4
    inverted: True

  - platform: pca9685
    id: pca1_5
    channel: 5
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_6
    channel: 6
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_7
    channel: 7
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_8
    channel: 8
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_9
    channel: 9
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_10
    channel: 10
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_11
    channel: 11
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_12
    channel: 12
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_13
    channel: 13
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  #   output: pca1_14 not connected on the PCB
  # - platform: pca9685
  #   id: pca1_14
  #   channel: 14
  #   inverted: True

  - platform: pca9685
    id: pca1_15
    channel: 15


# Define LED drivers as light components for esphome and hass automations
# https://esphome.io/components/light/index.html
light:  
  - platform: monochromatic
    name: "fl1HallwayCeilingLight"
    id: fl1HallwayCeilingLight
    output: pca1_0
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl1HallwayWallLight"
    id: fl1HallwayWallLight
    output: pca1_1
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl1ExteriorCeilingLight"
    id: fl1ExteriorCeilingLight
    output: pca1_2
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl1BathroomCeilingLight"
    id: fl1BathroomCeilingLight
    output: pca1_3
    restore_mode: RESTORE_DEFAULT_OFF
    
  - platform: monochromatic
    name: "fl1BathroomFloorHeating"
    id: fl1BathroomFloorHeating
    output: pca1_4
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1LivingroomCeilingLightEast"
    id: fl1LivingroomCeilingLightEast
    output: pca1_5
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1LivingroomCeilingLightCenter"
    id: fl1LivingroomCeilingLightCenter
    output: pca1_6
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1LivingroomCeilingLightWest"
    id: fl1LivingroomCeilingLightWest
    output: pca1_7
    restore_mode: RESTORE_DEFAULT_OFF
    
  - platform: monochromatic
    name: "fl1LivingroomWallLight"
    id: fl1LivingroomWallLight
    output: pca1_8
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1LivingroomTableLight"
    id: fl1LivingroomTableLight
    output: pca1_9
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1KitchenCeilingLight"
    id: fl1KitchenCeilingLight
    output: pca1_10
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl1StairsCeilingLight"
    id: fl1StairsCeilingLight
    output: pca1_11
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1StudyCeilingLight"
    id: fl1StudyCeilingLight
    output: pca1_12
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl1StudyWallLight"
    id: fl1StudyWallLight
    output: pca1_13
    restore_mode: RESTORE_DEFAULT_OFF
    
  #   output: pca1_14 not connected on the PCB

  - platform: monochromatic
    name: $upperDevicename Case Fan
    id: ${devicename}_case_fan
    output: pca1_15


# Define behaviour on lightswitch presses
# for detailed decription check switch_mappings.ods
binary_sensor:

#11 fl1HallwaySwitch_key1 controlling fl1HallwayCeilingLight
 
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch11Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch11Light}).remote_values.get_brightness()) < .05) return true; else return false;
    # lambda: if (float(id(${fl1LightSwitch11Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch11Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch11Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1HallwaySwitch_key1"
    id: fl1LightSwitch11
    pin:
      pcf8574: pcf8574_1
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch11Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch11Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch11Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch11Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch11Light}
              - binary_sensor.is_on: ${fl1LightSwitch11Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch11
                  - binary_sensor.is_off: ${fl1LightSwitch11Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch11Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch11Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch11Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch11
                  - light.is_on: ${fl1LightSwitch11Light}
                  - binary_sensor.is_off: ${fl1LightSwitch11Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch11Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#12 fl1HallwaySwitch_key2 controlling fl1HallwayWallLight
  
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch12Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch12Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch12Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch12Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1HallwaySwitch_key2"
    id: fl1LightSwitch12
    pin:
      pcf8574: pcf8574_1
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch12Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch12Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch12Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch12Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch12Light}
              - binary_sensor.is_on: ${fl1LightSwitch12Light}_dimMin
          then:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch12
                  - binary_sensor.is_off: ${fl1LightSwitch12Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch12Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch12Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch12Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch12
                  - light.is_on: ${fl1LightSwitch12Light}
                  - binary_sensor.is_off: ${fl1LightSwitch12Light}_dimMin
              then:
                - light.dim_relative:
                    id: ${fl1LightSwitch12Light}
                    relative_brightness: -5%
                    transition_length: 0.1s
                - delay: 0.1s

#13 fl1HallwaySwitch_key3 controlling fl1ExteriorCeilingLight
  - platform: gpio
    name: "fl1HallwaySwitch_key3"
    id: fl1LightSwitch13
    pin:
      pcf8574: pcf8574_1
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms  
  # on press, toggle light      
    on_press:
      then:
        light.toggle: 
          id: ${fl1LightSwitch13Light}
          transition_length: 0s

#14 fl1HallwaySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1HallwaySwitch_key4"
    id: fl1LightSwitch14
    pin:
      pcf8574: pcf8574_1
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#21 fl1BathroomSwitch_key1 controlling fl1BathroomCeilingLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch21Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch21Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch21Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch21Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1BathroomSwitch_key1"
    id: fl1LightSwitch21
    pin:
      pcf8574: pcf8574_1
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch21Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch21Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch21Light}
              transition_length: 0s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch21Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch21Light}
              - binary_sensor.is_on: ${fl1LightSwitch21Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch21
                  - binary_sensor.is_off: ${fl1LightSwitch21Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch21Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch21Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch21Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch21
                  - light.is_on: ${fl1LightSwitch21Light}
                  - binary_sensor.is_off: ${fl1LightSwitch21Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch21Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#22 fl1BathroomSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1BathroomSwitch_key2"
    id: fl1LightSwitch22
    pin:
      pcf8574: pcf8574_1
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#23 fl1BathroomSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1BathroomSwitch_key3"
    id: fl1LightSwitch23
    pin:
      pcf8574: pcf8574_1
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#24 fl1BathroomSwitch_key4 controlling fl1BathroomFloorHeating
  - platform: gpio
    name: "fl1BathroomSwitch_key4"
    id: fl1LightSwitch24
    pin:
      pcf8574: pcf8574_1
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light
    on_press:
      then:
        light.toggle: 
          id: ${fl1LightSwitch24Light}
          transition_length: 0s


#31 fl1UnderStairSwitch_key1 controlling fl1UnderStairLight
  - platform: gpio
    name: "fl1UnderStairSwitch_key1"
    id: fl1LightSwitch31
    pin:
      pcf8574: pcf8574_2
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#32 fl1UnderStairSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1UnderStairSwitch_key2"
    id: fl1LightSwitch32
    pin:
      pcf8574: pcf8574_2
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#33 fl1UnderStairSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1UnderStairSwitch_key3"
    id: fl1LightSwitch33
    pin:
      pcf8574: pcf8574_2
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#34 fl1UnderStairSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1UnderStairSwitch_key4"
    id: fl1LightSwitch34
    pin:
      pcf8574: pcf8574_2
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#41 fl1LivingroomSwitch_key1 controlling fl1LivingroomCeilingLights
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch41Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch41Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch41Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch41Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1LivingroomSwitch_key1"
    id: fl1LightSwitch41
    pin:
      pcf8574: pcf8574_2
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch41Light}
          then:
            - light.turn_on:
                id: ${fl1LightSwitch41Light}
                transition_length: 0s
            - light.turn_on:
                id: fl1LivingroomCeilingLightCenter
                transition_length: 0s
            - light.turn_on:
                id: fl1LivingroomCeilingLightWest
                transition_length: 0s
          else:
            - light.turn_off:
                id: ${fl1LightSwitch41Light}
                transition_length: 0s
            - light.turn_off:
                id: fl1LivingroomCeilingLightCenter
                transition_length: 0s
            - light.turn_off:
                id: fl1LivingroomCeilingLightWest
                transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        - light.turn_on: 
            id: ${fl1LightSwitch41Light}
            brightness: 100%
            transition_length: 0s
        - light.turn_on: 
            id: fl1LivingroomCeilingLightCenter
            brightness: 100%
            transition_length: 0s
        - light.turn_on: 
            id: fl1LivingroomCeilingLightWest
            brightness: 100%
            transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch41Light}
              - binary_sensor.is_on: ${fl1LightSwitch41Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch41
                  - binary_sensor.is_off: ${fl1LightSwitch41Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch41Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch41Light}
                        brightness: 5%
                    - light.turn_on:
                        id: fl1LivingroomCeilingLightCenter
                        brightness: 5%
                    - light.turn_on:
                        id: fl1LivingroomCeilingLightWest
                        brightness: 5%
                - light.dim_relative:
                    id: ${fl1LightSwitch41Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - light.dim_relative:
                    id: fl1LivingroomCeilingLightCenter
                    relative_brightness: 5%
                    transition_length: 0.1s
                - light.dim_relative:
                    id: fl1LivingroomCeilingLightWest
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch41
                  - light.is_on: ${fl1LightSwitch41Light}
                  - binary_sensor.is_off: ${fl1LightSwitch41Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch41Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - light.dim_relative:
                  id: fl1LivingroomCeilingLightCenter
                  relative_brightness: -5%
                  transition_length: 0.1s
              - light.dim_relative:
                  id: fl1LivingroomCeilingLightWest
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#42 fl1LivingroomSwitch_key2 controlling fl1LivingroomWallLights
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch42Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch42Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch42Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch42Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1LivingroomSwitch_key2"
    id: fl1LightSwitch42
    pin:
      pcf8574: pcf8574_2
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch42Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch42Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch42Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch42Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch42Light}
              - binary_sensor.is_on: ${fl1LightSwitch42Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch42
                  - binary_sensor.is_off: ${fl1LightSwitch42Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch42Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch42Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch42Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch42
                  - light.is_on: ${fl1LightSwitch42Light}
                  - binary_sensor.is_off: ${fl1LightSwitch42Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch42Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#43 fl1LivingroomSwitch_key3 controlling fl1LivingroomTableLights
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch43Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch43Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch43Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch43Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1LivingroomSwitch_key3"
    id: fl1LightSwitch43
    pin:
      pcf8574: pcf8574_2
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch43Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch43Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch43Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch43Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch43Light}
              - binary_sensor.is_on: ${fl1LightSwitch43Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch43
                  - binary_sensor.is_off: ${fl1LightSwitch43Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch43Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch43Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch43Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch43
                  - light.is_on: ${fl1LightSwitch43Light}
                  - binary_sensor.is_off: ${fl1LightSwitch43Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch43Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#44 fl1LivingroomSwitch_key4 controlling fl1KitchenCeilingLights
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch44Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch44Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch44Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch44Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1LivingroomSwitch_key4"
    id: fl1LightSwitch44
    pin:
      pcf8574: pcf8574_2
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch44Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch44Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch44Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch44Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch44Light}
              - binary_sensor.is_on: ${fl1LightSwitch44Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch44
                  - binary_sensor.is_off: ${fl1LightSwitch44Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch44Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch44Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch44Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch44
                  - light.is_on: ${fl1LightSwitch44Light}
                  - binary_sensor.is_off: ${fl1LightSwitch44Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch44Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s


#51 fl1LivingroomSwitch2_key1 controlling fl1LivingroomCeilingLight
  - platform: gpio
    name: "fl1LivingroomSwitch2_key1"
    id: fl1LightSwitch51
    pin:
      pcf8574: pcf8574_3
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch51Light}
          then:
            - light.turn_on:
                id: ${fl1LightSwitch51Light}
                transition_length: 0s
            - light.turn_on:
                id: fl1LivingroomCeilingLightCenter
                transition_length: 0s
            - light.turn_on:
                id: fl1LivingroomCeilingLightWest
                transition_length: 0s
          else:
            - light.turn_off:
                id: ${fl1LightSwitch51Light}
                transition_length: 0s
            - light.turn_off:
                id: fl1LivingroomCeilingLightCenter
                transition_length: 0s
            - light.turn_off:
                id: fl1LivingroomCeilingLightWest
                transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        - light.turn_on: 
            id: ${fl1LightSwitch51Light}
            brightness: 100%
            transition_length: 0s
        - light.turn_on: 
            id: fl1LivingroomCeilingLightCenter
            brightness: 100%
            transition_length: 0s
        - light.turn_on: 
            id: fl1LivingroomCeilingLightWest
            brightness: 100%
            transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch51Light}
              - binary_sensor.is_on: ${fl1LightSwitch51Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch51
                  - binary_sensor.is_off: ${fl1LightSwitch51Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch51Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch51Light}
                        brightness: 5%
                    - light.turn_on:
                        id: fl1LivingroomCeilingLightCenter
                        brightness: 5%
                    - light.turn_on:
                        id: fl1LivingroomCeilingLightWest
                        brightness: 5%
                - light.dim_relative:
                    id: ${fl1LightSwitch51Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - light.dim_relative:
                    id: fl1LivingroomCeilingLightCenter
                    relative_brightness: 5%
                    transition_length: 0.1s
                - light.dim_relative:
                    id: fl1LivingroomCeilingLightWest
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch51
                  - light.is_on: ${fl1LightSwitch51Light}
                  - binary_sensor.is_off: ${fl1LightSwitch51Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch51Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - light.dim_relative:
                  id: fl1LivingroomCeilingLightCenter
                  relative_brightness: -5%
                  transition_length: 0.1s
              - light.dim_relative:
                  id: fl1LivingroomCeilingLightWest
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#52 fl1LivingroomSwitch2_key2 controlling fl1LivingroomWallLights
  - platform: gpio
    name: "fl1LivingroomSwitch2_key2"
    id: fl1LightSwitch52
    pin:
      pcf8574: pcf8574_3
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch52Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch52Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch52Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch52Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch52Light}
              - binary_sensor.is_on: ${fl1LightSwitch52Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch52
                  - binary_sensor.is_off: ${fl1LightSwitch52Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch52Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch52Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch52Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch52
                  - light.is_on: ${fl1LightSwitch52Light}
                  - binary_sensor.is_off: ${fl1LightSwitch52Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch52Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#53 fl1LivingroomSwitch2_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1LivingroomSwitch2_key3"
    id: fl1LightSwitch53
    pin:
      pcf8574: pcf8574_3
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#54 fl1LivingroomSwitch2_key4 controlling fl1ExteriorCeilingLight
  - platform: gpio
    name: "fl1LivingroomSwitch2_key4"
    id: fl1LightSwitch54
    pin:
      pcf8574: pcf8574_3
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light      
    on_press:
      then:
        light.toggle:
          id: ${fl1LightSwitch54Light}
          transition_length: 0s


#61 fl1KitchenSwitch_key1 controlling fl1KitchenCeilingLights
  - platform: gpio
    name: "fl1KitchenSwitch_key1"
    id: fl1LightSwitch61
    pin:
      pcf8574: pcf8574_3
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch61Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch61Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch61Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch61Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch61Light}
              - binary_sensor.is_on: ${fl1LightSwitch61Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch61
                  - binary_sensor.is_off: ${fl1LightSwitch61Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch61Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch61Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch61Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch61
                  - light.is_on: ${fl1LightSwitch61Light}
                  - binary_sensor.is_off: ${fl1LightSwitch61Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch61Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#62 fl1KitchenSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1KitchenSwitch_key2"
    id: fl1LightSwitch62
    pin:
      pcf8574: pcf8574_3
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#63 fl1KitchenSwitch_key3 is controlling fl1LivingroomTableLight
  - platform: gpio
    name: "fl1KitchenSwitch_key3"
    id: fl1LightSwitch63
    pin:
      pcf8574: pcf8574_3
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch63Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch63Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch63Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch63Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch63Light}
              - binary_sensor.is_on: ${fl1LightSwitch63Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch63
                  - binary_sensor.is_off: ${fl1LightSwitch63Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch63Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch63Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch63Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch63
                  - light.is_on: ${fl1LightSwitch63Light}
                  - binary_sensor.is_off: ${fl1LightSwitch63Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch63Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#64 fl1KitchenSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1KitchenSwitch_key4"
    id: fl1LightSwitch64
    pin:
      pcf8574: pcf8574_3
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#71 fl1StairsSwitch_key1 controlling fl1StairsCeilingLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch71Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch71Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch71Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch71Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1StairsSwitch_key1"
    id: fl1LightSwitch71
    pin:
      pcf8574: pcf8574_4
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch71Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch71Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch71Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch71Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch71Light}
              - binary_sensor.is_on: ${fl1LightSwitch71Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch71
                  - binary_sensor.is_off: ${fl1LightSwitch71Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch71Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch71Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch71Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch71
                  - light.is_on: ${fl1LightSwitch71Light}
                  - binary_sensor.is_off: ${fl1LightSwitch71Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch71Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#72 fl1StairsSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1StairsSwitch_key2"
    id: fl1LightSwitch72
    pin:
      pcf8574: pcf8574_4
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#73 fl1StairsSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1StairsSwitch_key3"
    id: fl1LightSwitch73
    pin:
      pcf8574: pcf8574_4
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#74 fl1StairsSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1StairsSwitch_key4"
    id: fl1LightSwitch74
    pin:
      pcf8574: pcf8574_4
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#81 fl1StudySwitch_key1 controlling fl1StudyCeilingLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch81Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch81Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch81Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch81Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1StudySwitch_key1"
    id: fl1LightSwitch81
    pin:
      pcf8574: pcf8574_4
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch81Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch81Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch81Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch81Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch81Light}
              - binary_sensor.is_on: ${fl1LightSwitch81Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch81
                  - binary_sensor.is_off: ${fl1LightSwitch81Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch81Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch81Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch81Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch81
                  - light.is_on: ${fl1LightSwitch81Light}
                  - binary_sensor.is_off: ${fl1LightSwitch81Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch81Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#82 fl1StudySwitch_key2 controlling fl1StudyWallLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl1LightSwitch82Light}_dimMin
    lambda: if (float(id(${fl1LightSwitch82Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl1LightSwitch82Light}_dimMax
    lambda: if (float(id(${fl1LightSwitch82Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl1StudySwitch_key2"
    id: fl1LightSwitch82
    pin:
      pcf8574: pcf8574_4
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl1LightSwitch82Light}
          then:
            light.turn_on:
              id: ${fl1LightSwitch82Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl1LightSwitch82Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl1LightSwitch82Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl1LightSwitch82Light}
              - binary_sensor.is_on: ${fl1LightSwitch82Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch82
                  - binary_sensor.is_off: ${fl1LightSwitch82Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl1LightSwitch82Light}
                    then:
                    - light.turn_on:
                        id: ${fl1LightSwitch82Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl1LightSwitch82Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl1LightSwitch82
                  - light.is_on: ${fl1LightSwitch82Light}
                  - binary_sensor.is_off: ${fl1LightSwitch82Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl1LightSwitch82Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#83 fl1StudySwitch_key3 controlling fl1ExteriorCeilingLight
  - platform: gpio
    name: "fl1StudySwitch_key3"
    id: fl1LightSwitch83
    pin:
      pcf8574: pcf8574_4
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light      
    on_press:
      then:
        light.toggle:
          id: ${fl1LightSwitch83Light}
          transition_length: 0s

#84 fl1StudySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl1StudySwitch_key4"
    id: fl1LightSwitch84
    pin:
      pcf8574: pcf8574_4
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

############################# End of Switch behavior definition #############################
