### Light controller main
substitutions:
  devicename: illuminatiofl1
  upperDevicename: Floor1 Lights Controller
  # <<: !include ioMapping.yml
  <<: !include fl1SwitchMapping.yml

esphome:
  name: $devicename
  platform: ESP32
  board: esp32-poe

packages:
  # wifi: !include common/wifi.yml
  ethernet: !include common/ethernet.yml
  api: !include common/api.yml
  ota: !include common/ota.yml
  mqtt: !include common/mqtt.yml
  logger: !include common/logger.yml
  time: !include common/time.yml
  webserver: !include common/webserver.yml

i2c:
  scan: True

# load module for PCF8574 Remote 8-Bit I/O Expanderfor I2C Bus
# datasheet https://www.ti.com/lit/ds/symlink/pcf8574.pdf
pcf8574:
  - id: 'pcf8574_1'
    address: 0x38
    pcf8575: False

  - id: 'pcf8574_2'
    address: 0x39
    pcf8575: False

  - id: 'pcf8574_3'
    address: 0x3A
    pcf8575: False

  - id: 'pcf8574_4'
    address: 0x3B
    pcf8575: False

  # - id: 'pcf8574_1'
  #   address: 0x20
  #   pcf8575: False

  # - id: 'pcf8574_2'
  #   address: 0x21
  #   pcf8575: False

  # - id: 'pcf8574_3'
  #   address: 0x22
  #   pcf8575: False

  # - id: 'pcf8574_4'
  #   address: 0x23
  #   pcf8575: False

# Individual outputs
switch:
  - platform: restart
    name: $upperDevicename Restart

# Temp sensor
sensor:
  - platform: bmp085
    temperature:
      name: "$upperDevicename enclosure Temperature"
    pressure:
      name: "$upperDevicename enclosure Pressure"
    update_interval: 300s


# load module for PCA9685 16-Channel 12-bit PWM/Servo Driver I2C
# datasheet https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf
pca9685:
  - frequency: 500

#Define PCA9685 PWM chnnels and register them as outputs in ESPHome
# pins 0-15 are defined as channel 0-15
output:
  - platform: pca9685
    id: pca1_0
    channel: 0
    inverted: True

  - platform: pca9685
    id: pca1_1
    channel: 1
    inverted: True

  - platform: pca9685
    id: pca1_2
    channel: 2
    inverted: True

  - platform: pca9685
    id: pca1_3
    channel: 3
    inverted: True

  - platform: pca9685
    id: pca1_4
    channel: 4
    inverted: True

  - platform: pca9685
    id: pca1_5
    channel: 5
    inverted: True

  - platform: pca9685
    id: pca1_6
    channel: 6
    inverted: True

  - platform: pca9685
    id: pca1_7
    channel: 7
    inverted: True

  - platform: pca9685
    id: pca1_8
    channel: 8
    inverted: True

  - platform: pca9685
    id: pca1_9
    channel: 9
    inverted: True

  - platform: pca9685
    id: pca1_10
    channel: 10
    inverted: True

  - platform: pca9685
    id: pca1_11
    channel: 11
    inverted: True

  - platform: pca9685
    id: pca1_12
    channel: 12
    inverted: True

  - platform: pca9685
    id: pca1_13
    channel: 13
    inverted: True

  #   output: pca1_14 not connected on the PCB
  # - platform: pca9685
  #   id: pca1_14
  #   channel: 14
  #   inverted: True

  - platform: pca9685
    id: pca1_15
    channel: 15


# Define LED drivers as light components for esphome and hass automations
# https://esphome.io/components/light/index.html
light:  
  - platform: monochromatic
    name: "fl1hallwayCeilingLight"
    id: fl1hallwayCeilingLight
    output: pca1_0

  - platform: monochromatic
    name: "fl1hallwayWallLight"
    id: fl1hallwayWallLight
    output: pca1_1

  - platform: monochromatic
    name: "exteriorCeilingLight"
    id: exteriorCeilingLight
    output: pca1_2

  - platform: monochromatic
    name: "fl1bathroomCeilingLight"
    id: fl1bathroomCeilingLight
    output: pca1_3
    
  - platform: monochromatic
    name: "fl1bathroomShowerLight"
    id: fl1bathroomShowerLight
    output: pca1_4
        
  - platform: monochromatic
    name: "fl1bathroomFloorHeating"
    id: fl1bathroomFloorHeating
    output: pca1_5
        
  - platform: monochromatic
    name: "underStairLight"
    id: underStairLight
    output: pca1_6
        
  - platform: monochromatic
    name: "livingroomCeilingLight"
    id: livingroomCeilingLight
    output: pca1_7
    
  - platform: monochromatic
    name: "livingroomWallLight"
    id: livingroomWallLight
    output: pca1_8
        
  - platform: monochromatic
    name: "livingroomTableLight"
    id: livingroomTableLight
    output: pca1_9
        
  - platform: monochromatic
    name: "kitchenCeilingLight"
    id: kitchenCeilingLight
    output: pca1_10

  - platform: monochromatic
    name: "stairsCeilingLight"
    id: stairsCeilingLight
    output: pca1_11
        
  - platform: monochromatic
    name: "${lightSwitch81Light}"
    id: ${lightSwitch81Light}
    output: pca1_12
        
  - platform: monochromatic
    name: "studyWallLight"
    id: studyWallLight
    output: pca1_13
    
  #   output: pca1_14 not connected on the PCB

  - platform: monochromatic
    name: $upperDevicename Case Fan
    id: ${devicename}_case_fan
    output: pca1_15


# Define behaviour on lightswitch presses
# for detailed decription check switch_mappings.ods
binary_sensor:

# hallwaySwitch_key1 controlling fl1hallwayCeilingLight
 
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch11Light}_dimMin
    lambda: if (float(id(${lightSwitch11Light}).remote_values.get_brightness()) < .55) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${lightSwitch11Light}_dimMax
    lambda: if (float(id(${lightSwitch11Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "hallwaySwitch_key1"
    id: lightSwitch11
    pin:
      pcf8574: pcf8574_1
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch11Light}
          then:
            light.turn_on:
              id: ${lightSwitch11Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch11Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch11Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch11Light}
              - binary_sensor.is_on: ${lightSwitch11Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch11
                  - binary_sensor.is_off: ${lightSwitch11Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch11Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch11Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch11Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch11
                  - light.is_on: ${lightSwitch11Light}
                  - binary_sensor.is_off: ${lightSwitch11Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch11Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# hallwaySwitch_key2 controlling fl1hallwayWallLight
  
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch12Light}_dimMin
    lambda: if (float(id(${lightSwitch12Light}).remote_values.get_brightness()) < .55) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${lightSwitch12Light}_dimMax
    lambda: if (float(id(${lightSwitch12Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "hallwaySwitch_key2"
    id: lightSwitch12
    pin:
      pcf8574: pcf8574_1
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch12Light}
          then:
            light.turn_on:
              id: ${lightSwitch12Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch12Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch12Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch12Light}
              - binary_sensor.is_on: ${lightSwitch12Light}_dimMin
          then:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch12
                  - binary_sensor.is_off: ${lightSwitch12Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch12Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch12Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch12Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch12
                  - light.is_on: ${lightSwitch12Light}
                  - binary_sensor.is_off: ${lightSwitch12Light}_dimMin
              then:
                - light.dim_relative:
                    id: ${lightSwitch12Light}
                    relative_brightness: -5%
                    transition_length: 0.1s
                - delay: 0.1s

# hallwaySwitch_key3 controlling exteriorCeilingLight
  - platform: gpio
    name: "hallwaySwitch_key3"
    id: lightSwitch13
    pin:
      pcf8574: pcf8574_1
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms  
  # on press, toggle light      
    on_press:
      then:
        light.toggle: 
          id: ${lightSwitch13Light}
          transition_length: 0s

# hallwaySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "hallwaySwitch_key4"
    id: lightSwitch14
    pin:
      pcf8574: pcf8574_1
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# bathroomSwitch_key1 controlling fl1bathroomCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch21Light}_dimMin
    lambda: if (float(id(${lightSwitch21Light}).remote_values.get_brightness()) < .55) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${lightSwitch21Light}_dimMax
    lambda: if (float(id(${lightSwitch21Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "bathroomSwitch_key1"
    id: lightSwitch21
    pin:
      pcf8574: pcf8574_1
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch21Light}
          then:
            light.turn_on:
              id: ${lightSwitch21Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch21Light}
              transition_length: 3s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch21Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch21Light}
              - binary_sensor.is_on: ${lightSwitch21Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch21
                  - binary_sensor.is_off: ${lightSwitch21Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch21Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch21Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch21Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch21
                  - light.is_on: ${lightSwitch21Light}
                  - binary_sensor.is_off: ${lightSwitch21Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch21Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# bathroomSwitch_key2 controlling fl1bathroomShowerLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch22Light}_dimMin
    lambda: if (float(id(${lightSwitch22Light}).remote_values.get_brightness()) < .55) return true; else return false;    

  # set the maximum dimming value to 1
  - platform: template
    id: ${lightSwitch22Light}_dimMax
    lambda: if (float(id(${lightSwitch22Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "bathroomSwitch_key2"
    id: lightSwitch22
    pin:
      pcf8574: pcf8574_1
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch22Light}
          then:
            light.turn_on:
              id: ${lightSwitch22Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch22Light}
              transition_length: 3s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch22Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch22Light}
              - binary_sensor.is_on: ${lightSwitch22Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch22
                  - binary_sensor.is_off: ${lightSwitch22Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch22Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch22Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch22Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch22
                  - light.is_on: ${lightSwitch22Light}
                  - binary_sensor.is_off: ${lightSwitch22Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch22Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# bathroomSwitch_key3 controlling fl1bathroomFloorHeating
  - platform: gpio
    name: "bathroomSwitch_key3"
    id: lightSwitch23
    pin:
      pcf8574: pcf8574_1
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light
    on_press:
      then:
        light.toggle: 
          id: ${lightSwitch23Light}
          transition_length: 0s

# bathroomSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "bathroomSwitch_key4"
    id: lightSwitch24
    pin:
      pcf8574: pcf8574_1
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# underStairSwitch_key1 controlling underStairLight
  - platform: gpio
    name: "underStairSwitch_key1"
    id: lightSwitch31
    pin:
      pcf8574: pcf8574_2
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light
    on_press:
      then:
        light.toggle:
          id: ${lightSwitch31Light}
          transition_length: 0s

# underStairSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "underStairSwitch_key2"
    id: lightSwitch32
    pin:
      pcf8574: pcf8574_2
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# underStairSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "underStairSwitch_key3"
    id: lightSwitch33
    pin:
      pcf8574: pcf8574_2
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# underStairSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "underStairSwitch_key4"
    id: lightSwitch34
    pin:
      pcf8574: pcf8574_2
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# livingroomSwitch_key1 controlling livingroomCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch41Light}_dimMin
    lambda: if (float(id(${lightSwitch41Light}).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key1"
    id: lightSwitch41
    pin:
      pcf8574: pcf8574_2
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch41Light}
          then:
            light.turn_on:
              id: ${lightSwitch41Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch41Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch41Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch41Light}
              - binary_sensor.is_on: ${lightSwitch41Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch41
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch41Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch41Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch41Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch41
                  - light.is_on: ${lightSwitch41Light}
                  - binary_sensor.is_off: ${lightSwitch41Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch41Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch_key2 controlling livingroomWallLights
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch42Light}_dimMin
    lambda: if (float(id(${lightSwitch42Light}).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key2"
    id: lightSwitch42
    pin:
      pcf8574: pcf8574_2
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch42Light}
          then:
            light.turn_on:
              id: ${lightSwitch42Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch42Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch42Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch42Light}
              - binary_sensor.is_on: ${lightSwitch42Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch42
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch42Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch42Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch42Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch42
                  - light.is_on: ${lightSwitch42Light}
                  - binary_sensor.is_off: ${lightSwitch42Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch42Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch_key3 controlling livingroomTableLights
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch43Light}_dimMin
    lambda: if (float(id(${lightSwitch43Light}).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key3"
    id: lightSwitch43
    pin:
      pcf8574: pcf8574_2
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch43Light}
          then:
            light.turn_on:
              id: ${lightSwitch43Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch43Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch43Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch43Light}
              - binary_sensor.is_on: ${lightSwitch43Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch43
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch43Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch43Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch43Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch43
                  - light.is_on: ${lightSwitch43Light}
                  - binary_sensor.is_off: ${lightSwitch43Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch43Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch_key4 controlling kitchenCeilingLights
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch44Light}_dimMin
    lambda: if (float(id(${lightSwitch44Light}).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key4"
    id: lightSwitch44
    pin:
      pcf8574: pcf8574_2
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch44Light}
          then:
            light.turn_on:
              id: ${lightSwitch44Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch44Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch44Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch44Light}
              - binary_sensor.is_on: ${lightSwitch44Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch44
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch44Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch44Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch44Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch44
                  - light.is_on: ${lightSwitch44Light}
                  - binary_sensor.is_off: ${lightSwitch44Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch44Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s


# livingroomSwitch2_key1 controlling livingroomCeilingLight
  - platform: gpio
    name: "livingroomSwitch2_key1"
    id: lightSwitch51
    pin:
      pcf8574: pcf8574_3
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch51Light}
          then:
            light.turn_on:
              id: ${lightSwitch51Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch51Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch51Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch51Light}
              - binary_sensor.is_on: ${lightSwitch51Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch51
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch51Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch51Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch51Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch51
                  - light.is_on: ${lightSwitch51Light}
                  - binary_sensor.is_off: ${lightSwitch51Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch51Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch2_key2 controlling livingroomWallLights
  - platform: gpio
    name: "livingroomSwitch2_key2"
    id: lightSwitch52
    pin:
      pcf8574: pcf8574_3
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch52Light}
          then:
            light.turn_on:
              id: ${lightSwitch52Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch52Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch52Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch52Light}
              - binary_sensor.is_on: ${lightSwitch52Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch52
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch52Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch52Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch52Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch52
                  - light.is_on: ${lightSwitch52Light}
                  - binary_sensor.is_off: ${lightSwitch52Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch52Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch2_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "livingroomSwitch2_key3"
    id: lightSwitch53
    pin:
      pcf8574: pcf8574_3
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# livingroomSwitch2_key4 controlling exteriorCeilingLight
  - platform: gpio
    name: "livingroomSwitch2_key4"
    id: lightSwitch54
    pin:
      pcf8574: pcf8574_3
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light      
    on_press:
      then:
        light.toggle:
          id: ${lightSwitch54Light}
          transition_length: 0s


# kitchenSwitch_key1 controlling kitchenCeilingLights
  - platform: gpio
    name: "kitchenSwitch_key1"
    id: lightSwitch61
    pin:
      pcf8574: pcf8574_3
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch61Light}
          then:
            light.turn_on:
              id: ${lightSwitch61Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch61Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch61Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch61Light}
              - binary_sensor.is_on: ${lightSwitch61Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch61
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch61Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch61Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch61Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch61
                  - light.is_on: ${lightSwitch61Light}
                  - binary_sensor.is_off: ${lightSwitch61Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch61Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# kitchenSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "kitchenSwitch_key2"
    id: lightSwitch62
    pin:
      pcf8574: pcf8574_3
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# kitchenSwitch_key3 is controlling livingroomTableLight
  - platform: gpio
    name: "kitchenSwitch_key3"
    id: lightSwitch63
    pin:
      pcf8574: pcf8574_3
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch63Light}
          then:
            light.turn_on:
              id: ${lightSwitch63Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch63Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch63Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch63Light}
              - binary_sensor.is_on: ${lightSwitch63Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch63
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch63Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch63Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch63Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch63
                  - light.is_on: ${lightSwitch63Light}
                  - binary_sensor.is_off: ${lightSwitch63Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch63Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# kitchenSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "kitchenSwitch_key4"
    id: lightSwitch64
    pin:
      pcf8574: pcf8574_3
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# stairsSwitch_key1 controlling stairsCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch71Light}_dimMin
    lambda: if (float(id(${lightSwitch71Light}).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "stairsSwitch_key1"
    id: lightSwitch71
    pin:
      pcf8574: pcf8574_4
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch71Light}
          then:
            light.turn_on:
              id: ${lightSwitch71Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch71Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch71Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch71Light}
              - binary_sensor.is_on: ${lightSwitch71Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch71
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch71Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch71Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch71Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch71
                  - light.is_on: ${lightSwitch71Light}
                  - binary_sensor.is_off: ${lightSwitch71Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch71Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# stairsSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "stairsSwitch_key2"
    id: lightSwitch72
    pin:
      pcf8574: pcf8574_4
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# stairsSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "stairsSwitch_key3"
    id: lightSwitch73
    pin:
      pcf8574: pcf8574_4
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# stairsSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "stairsSwitch_key4"
    id: lightSwitch74
    pin:
      pcf8574: pcf8574_4
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# studySwitch_key1 controlling studyCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch81Light}_dimMin
    lambda: if (float(id(${lightSwitch81Light}).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "studySwitch_key1"
    id: lightSwitch81
    pin:
      pcf8574: pcf8574_4
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch81Light}
          then:
            light.turn_on:
              id: ${lightSwitch81Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch81Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch81Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch81Light}
              - binary_sensor.is_on: ${lightSwitch81Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch81
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch81Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch81Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch81Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch81
                  - light.is_on: ${lightSwitch81Light}
                  - binary_sensor.is_off: ${lightSwitch81Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch81Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# studySwitch_key2 controlling studyWallLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: ${lightSwitch82Light}_dimMin
    lambda: if (float(id(${lightSwitch82Light}).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "studySwitch_key2"
    id: lightSwitch82
    pin:
      pcf8574: pcf8574_4
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${lightSwitch82Light}
          then:
            light.turn_on:
              id: ${lightSwitch82Light}
              transition_length: 1s
          else:
            light.turn_off:
              id: ${lightSwitch82Light}
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${lightSwitch82Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${lightSwitch82Light}
              - binary_sensor.is_on: ${lightSwitch82Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch82
              then:
                - if:
                    condition:
                      light.is_off: ${lightSwitch82Light}
                    then:
                    - light.turn_on:
                        id: ${lightSwitch82Light}
                        brightness: 40%  
                - light.dim_relative:
                    id: ${lightSwitch82Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch82
                  - light.is_on: ${lightSwitch82Light}
                  - binary_sensor.is_off: ${lightSwitch82Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${lightSwitch82Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# studySwitch_key3 controlling exteriorCeilingLight
  - platform: gpio
    name: "studySwitch_key3"
    id: lightSwitch83
    pin:
      pcf8574: pcf8574_4
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light      
    on_press:
      then:
        light.toggle:
          id: ${lightSwitch83Light}
          transition_length: 0s

# studySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "studySwitch_key4"
    id: lightSwitch84
    pin:
      pcf8574: pcf8574_4
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

############################# End of Switch behavior definition #############################