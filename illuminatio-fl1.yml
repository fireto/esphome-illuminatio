### Light controller main
substitutions:
  devicename: illuminatio_fl1
  upperDevicename: Floor1 Lights Controller
  <<: !include ioMapping.yml

esphome:
  name: $devicename
  platform: ESP32
  board: esp32-poe

packages:
  # wifi: !include common/wifi.yml
  # ethernet: !include common/ethernet.yml
  # api: !include common/api.yml
  # ota: !include common/ota.yml
  # mqtt: !include common/mqtt.yml
  logger: !include common/logger.yml
  # time: !include common/time.yml
    
i2c:
#  sda: D1
#  scl: D2
  scan: True

# load module for PCF8574 Remote 8-Bit I/O Expanderfor I2C Bus
# datasheet https://www.ti.com/lit/ds/symlink/pcf8574.pdf
pcf8574:
  - id: 'pcf8574_1'
    address: 0x38
    pcf8575: False

  - id: 'pcf8574_2'
    address: 0x39
    pcf8575: False

  - id: 'pcf8574_3'
    address: 0x3A
    pcf8575: False

  - id: 'pcf8574_4'
    address: 0x3B
    pcf8575: False

# Individual outputs
switch:
  - platform: restart
    name: $upperDevicename Restart

# Temp sensor
sensor:
  - platform: bmp085
    temperature:
      name: "$upperDevicename enclosure Temperature"
    pressure:
      name: "$upperDevicename enclosure Pressure"
    update_interval: 300s


# load module for PCA9685 16-Channel 12-bit PWM/Servo Driver I2C
# datasheet https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf
pca9685:
  - frequency: 1000

#Define PCA9685 PWM chnnels and register them as outputs in ESPHome
# pins 0-15 are defined as channel 0-15
output:
  - platform: pca9685
    id: pca1_0
    channel: 0

  - platform: pca9685
    id: pca1_1
    channel: 1

  - platform: pca9685
    id: pca1_2
    channel: 2

  - platform: pca9685
    id: pca1_3
    channel: 3

  - platform: pca9685
    id: pca1_4
    channel: 4

  - platform: pca9685
    id: pca1_5
    channel: 5

  - platform: pca9685
    id: pca1_6
    channel: 6

  - platform: pca9685
    id: pca1_7
    channel: 7

  - platform: pca9685
    id: pca1_8
    channel: 8

  - platform: pca9685
    id: pca1_9
    channel: 9

  - platform: pca9685
    id: pca1_10
    channel: 10

  - platform: pca9685
    id: pca1_11
    channel: 11

  - platform: pca9685
    id: pca1_12
    channel: 12

  - platform: pca9685
    id: pca1_13
    channel: 13

  # - platform: pca9685
  #   id: pca1_14
  #   channel: 14

  - platform: pca9685
    id: pca1_15
    channel: 15


# Define LED drivers as light components for esphome and hass automations
# https://esphome.io/components/light/index.html
light:  
  - platform: monochromatic
    name: "fl1hallwayCeilingLight"
    id: fl1hallwayCeilingLight
    output: pca1_0

  - platform: monochromatic
    name: "fl1hallwayWallLight"
    id: fl1hallwayWallLight
    output: pca1_1

  - platform: monochromatic
    name: "exteriorCeilingLight"
    id: exteriorCeilingLight
    output: pca1_2

  - platform: monochromatic
    name: "fl1bathroomCeilingLight"
    id: fl1bathroomCeilingLight
    output: pca1_3
    
  - platform: monochromatic
    name: "fl1bathroomShowerLight"
    id: fl1bathroomShowerLight
    output: pca1_4
        
  - platform: monochromatic
    name: "fl1bathroomFloorHeating"
    id: fl1bathroomFloorHeating
    output: pca1_5
        
  - platform: monochromatic
    name: "underStairLight"
    id: underStairLight
    output: pca1_6
        
  - platform: monochromatic
    name: "livingroomCeilingLight"
    id: livingroomCeilingLight
    output: pca1_7
    
  - platform: monochromatic
    name: "livingroomWallLight"
    id: livingroomWallLight
    output: pca1_8
        
  - platform: monochromatic
    name: "livingroomTableLight"
    id: livingroomTableLight
    output: pca1_9
        
  - platform: monochromatic
    name: "kitchenCeilingLight"
    id: kitchenCeilingLight
    output: pca1_10

  - platform: monochromatic
    name: "stairsCeilingLight"
    id: stairsCeilingLight
    output: pca1_11
        
  - platform: monochromatic
    name: "studyCeilingLight"
    id: studyCeilingLight
    output: pca1_12
        
  - platform: monochromatic
    name: "studyWallLight"
    id: studyWallLight
    output: pca1_13
    
  #   output: pca1_14 not connected on the PCB

  - platform: monochromatic
    name: $upperDevicename Case Fan
    id: ${devicename}_case_fan
    output: pca1_15


# Define behaviour on lightswitch presses
# for detailed decription check switch_mappings.ods
binary_sensor:

# hallwaySwitch_key1 controlling fl1hallwayCeilingLight
 
  # set the minimum dimming value to 0.55
  - platform: template
    id: fl1hallwayCeilingLight_dimMin
    lambda: if (float(id(fl1hallwayCeilingLight).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "hallwaySwitch_key1"
    id: lightSwitch11
    pin:
      pcf8574: pcf8574_1
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: fl1hallwayCeilingLight
          then:
            light.turn_on:
              id: fl1hallwayCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: fl1hallwayCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: fl1hallwayCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: fl1hallwayCeilingLight
              - binary_sensor.is_on: fl1hallwayCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch11
              then:
                - if:
                    condition:
                      light.is_off: fl1hallwayCeilingLight
                    then:
                    - light.turn_on:
                        id: fl1hallwayCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: fl1hallwayCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch11
                  - light.is_on: fl1hallwayCeilingLight
                  - binary_sensor.is_off: fl1hallwayCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: fl1hallwayCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# hallwaySwitch_key2 controlling fl1hallwayWallLight
  - platform: gpio
    name: "hallwaySwitch_key2"
    id: lightSwitch12
    pin:
      pcf8574: pcf8574_1
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
        light.toggle: fl1hallwayWallLight
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: fl1hallwayWallLight
          brightness: 100%
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            light.is_off: fl1hallwayWallLight
          then:
          - delay: 0.5s
          - while:
              condition:
                binary_sensor.is_on: lightSwitch12
              then:
                - light.dim_relative:
                    id: fl1hallwayWallLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch12
                  - light.is_on: fl1hallwayWallLight
              then:
                - light.dim_relative:
                    id: fl1hallwayWallLight
                    relative_brightness: -5%
                    transition_length: 0.1s
                - delay: 1s

# hallwaySwitch_key3 controlling exteriorCeilingLight
  - platform: gpio
    name: "hallwaySwitch_key3"
    id: lightSwitch13
    pin:
      pcf8574: pcf8574_1
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms  
  # on single click, toggle light      
    on_click:
      then:
        light.toggle: exteriorCeilingLight

# hallwaySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "hallwaySwitch_key4"
    id: lightSwitch14
    pin:
      pcf8574: pcf8574_1
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# bathroomSwitch_key1 controlling fl1bathroomCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: fl1bathroomCeilingLight_dimMin
    lambda: if (float(id(fl1bathroomCeilingLight).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "bathroomSwitch_key1"
    id: lightSwitch21
    pin:
      pcf8574: pcf8574_1
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: fl1bathroomCeilingLight
          then:
            light.turn_on:
              id: fl1bathroomCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: fl1bathroomCeilingLight
              transition_length: 3s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: fl1bathroomCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: fl1bathroomCeilingLight
              - binary_sensor.is_on: fl1bathroomCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch21
              then:
                - if:
                    condition:
                      light.is_off: fl1bathroomCeilingLight
                    then:
                    - light.turn_on:
                        id: fl1bathroomCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: fl1bathroomCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch21
                  - light.is_on: fl1bathroomCeilingLight
                  - binary_sensor.is_off: fl1bathroomCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: fl1bathroomCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# bathroomSwitch_key2 controlling fl1bathroomShowerLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: fl1bathroomShowerLight_dimMin
    lambda: if (float(id(fl1bathroomShowerLight).remote_values.get_brightness()) < .55) return true; else return false;    
      
  - platform: gpio
    name: "bathroomSwitch_key2"
    id: lightSwitch22
    pin:
      pcf8574: pcf8574_1
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: fl1bathroomShowerLight
          then:
            light.turn_on:
              id: fl1bathroomShowerLight
              transition_length: 1s
          else:
            light.turn_off:
              id: fl1bathroomShowerLight
              transition_length: 3s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: fl1bathroomShowerLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: fl1bathroomShowerLight
              - binary_sensor.is_on: fl1bathroomShowerLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch22
              then:
                - if:
                    condition:
                      light.is_off: fl1bathroomShowerLight
                    then:
                    - light.turn_on:
                        id: fl1bathroomShowerLight
                        brightness: 40%  
                - light.dim_relative:
                    id: fl1bathroomShowerLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch22
                  - light.is_on: fl1bathroomShowerLight
                  - binary_sensor.is_off: fl1bathroomShowerLight_dimMin
              then:
              - light.dim_relative:
                  id: fl1bathroomShowerLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# bathroomSwitch_key3 controlling fl1bathroomFloorHeating
  - platform: gpio
    name: "bathroomSwitch_key3"
    id: lightSwitch23
    pin:
      pcf8574: pcf8574_1
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
        light.toggle: fl1bathroomFloorHeating      

# bathroomSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "bathroomSwitch_key4"
    id: lightSwitch24
    pin:
      pcf8574: pcf8574_1
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# underStairSwitch_key1 controlling underStairLight
  - platform: gpio
    name: "underStairSwitch_key1"
    id: lightSwitch31
    pin:
      pcf8574: pcf8574_2
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
        light.toggle: underStairLight

# underStairSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "underStairSwitch_key2"
    id: lightSwitch32
    pin:
      pcf8574: pcf8574_2
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# underStairSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "underStairSwitch_key3"
    id: lightSwitch33
    pin:
      pcf8574: pcf8574_2
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# underStairSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "underStairSwitch_key4"
    id: lightSwitch34
    pin:
      pcf8574: pcf8574_2
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# livingroomSwitch_key1 controlling livingroomCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: livingroomCeilingLight_dimMin
    lambda: if (float(id(livingroomCeilingLight).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key1"
    id: lightSwitch41
    pin:
      pcf8574: pcf8574_2
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: livingroomCeilingLight
          then:
            light.turn_on:
              id: livingroomCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: livingroomCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: livingroomCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: livingroomCeilingLight
              - binary_sensor.is_on: livingroomCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch41
              then:
                - if:
                    condition:
                      light.is_off: livingroomCeilingLight
                    then:
                    - light.turn_on:
                        id: livingroomCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: livingroomCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch41
                  - light.is_on: livingroomCeilingLight
                  - binary_sensor.is_off: livingroomCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: livingroomCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch_key2 controlling livingroomWallLights
  # set the minimum dimming value to 0.55
  - platform: template
    id: livingroomWallLight_dimMin
    lambda: if (float(id(livingroomWallLight).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key2"
    id: lightSwitch42
    pin:
      pcf8574: pcf8574_2
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: livingroomWallLight
          then:
            light.turn_on:
              id: livingroomWallLight
              transition_length: 1s
          else:
            light.turn_off:
              id: livingroomWallLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: livingroomWallLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: livingroomWallLight
              - binary_sensor.is_on: livingroomWallLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch42
              then:
                - if:
                    condition:
                      light.is_off: livingroomWallLight
                    then:
                    - light.turn_on:
                        id: livingroomWallLight
                        brightness: 40%  
                - light.dim_relative:
                    id: livingroomWallLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch42
                  - light.is_on: livingroomWallLight
                  - binary_sensor.is_off: livingroomWallLight_dimMin
              then:
              - light.dim_relative:
                  id: livingroomWallLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch_key3 controlling livingroomTableLights
  # set the minimum dimming value to 0.55
  - platform: template
    id: livingroomTableLight_dimMin
    lambda: if (float(id(livingroomTableLight).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key3"
    id: lightSwitch43
    pin:
      pcf8574: pcf8574_2
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: livingroomTableLight
          then:
            light.turn_on:
              id: livingroomTableLight
              transition_length: 1s
          else:
            light.turn_off:
              id: livingroomTableLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: livingroomTableLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: livingroomTableLight
              - binary_sensor.is_on: livingroomTableLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch43
              then:
                - if:
                    condition:
                      light.is_off: livingroomTableLight
                    then:
                    - light.turn_on:
                        id: livingroomTableLight
                        brightness: 40%  
                - light.dim_relative:
                    id: livingroomTableLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch43
                  - light.is_on: livingroomTableLight
                  - binary_sensor.is_off: livingroomTableLight_dimMin
              then:
              - light.dim_relative:
                  id: livingroomTableLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch_key4 controlling kitchenCeilingLights
  # set the minimum dimming value to 0.55
  - platform: template
    id: kitchenCeilingLight_dimMin
    lambda: if (float(id(kitchenCeilingLight).remote_values.get_brightness()) < .55) return true; else return false;
  - platform: gpio
    name: "livingroomSwitch_key4"
    id: lightSwitch44
    pin:
      pcf8574: pcf8574_2
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: kitchenCeilingLight
          then:
            light.turn_on:
              id: kitchenCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: kitchenCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: kitchenCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: kitchenCeilingLight
              - binary_sensor.is_on: kitchenCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch44
              then:
                - if:
                    condition:
                      light.is_off: kitchenCeilingLight
                    then:
                    - light.turn_on:
                        id: kitchenCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: kitchenCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch44
                  - light.is_on: kitchenCeilingLight
                  - binary_sensor.is_off: kitchenCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: kitchenCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s


# livingroomSwitch2_key1 controlling livingroomCeilingLight
  - platform: gpio
    name: "livingroomSwitch2_key1"
    id: lightSwitch51
    pin:
      pcf8574: pcf8574_3
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: livingroomCeilingLight
          then:
            light.turn_on:
              id: livingroomCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: livingroomCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: livingroomCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: livingroomCeilingLight
              - binary_sensor.is_on: livingroomCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch51
              then:
                - if:
                    condition:
                      light.is_off: livingroomCeilingLight
                    then:
                    - light.turn_on:
                        id: livingroomCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: livingroomCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch51
                  - light.is_on: livingroomCeilingLight
                  - binary_sensor.is_off: livingroomCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: livingroomCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch2_key2 controlling livingroomWallLights
  - platform: gpio
    name: "livingroomSwitch2_key2"
    id: lightSwitch52
    pin:
      pcf8574: pcf8574_3
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: livingroomWallLight
          then:
            light.turn_on:
              id: livingroomWallLight
              transition_length: 1s
          else:
            light.turn_off:
              id: livingroomWallLight
              transition_length: 3s
    # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: livingroomWallLight
          brightness: 100%
          transition_length: 0s
    # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: livingroomWallLight
              - binary_sensor.is_on: livingroomWallLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch52
              then:
                - if:
                    condition:
                      light.is_off: livingroomWallLight
                    then:
                    - light.turn_on:
                        id: livingroomWallLight
                        brightness: 40%  
                - light.dim_relative:
                    id: livingroomWallLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch52
                  - light.is_on: livingroomWallLight
                  - binary_sensor.is_off: livingroomWallLight_dimMin
              then:
              - light.dim_relative:
                  id: livingroomWallLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# livingroomSwitch2_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "livingroomSwitch2_key3"
    id: lightSwitch53
    pin:
      pcf8574: pcf8574_3
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# livingroomSwitch2_key4 controlling exteriorCeilingLight
  - platform: gpio
    name: "livingroomSwitch2_key4"
    id: lightSwitch54
    pin:
      pcf8574: pcf8574_3
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light      
    on_click:
      then:
        light.toggle: exteriorCeilingLight


# kitchenSwitch_key1 controlling kitchenCeilingLights
  - platform: gpio
    name: "kitchenSwitch_key1"
    id: lightSwitch61
    pin:
      pcf8574: pcf8574_3
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: kitchenCeilingLight
          then:
            light.turn_on:
              id: kitchenCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: kitchenCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: kitchenCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: kitchenCeilingLight
              - binary_sensor.is_on: kitchenCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch61
              then:
                - if:
                    condition:
                      light.is_off: kitchenCeilingLight
                    then:
                    - light.turn_on:
                        id: kitchenCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: kitchenCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch61
                  - light.is_on: kitchenCeilingLight
                  - binary_sensor.is_off: kitchenCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: kitchenCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# kitchenSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "kitchenSwitch_key2"
    id: lightSwitch62
    pin:
      pcf8574: pcf8574_3
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# kitchenSwitch_key3 is controlling livingroomTableLight
  - platform: gpio
    name: "kitchenSwitch_key3"
    id: lightSwitch63
    pin:
      pcf8574: pcf8574_3
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: livingroomTableLight
          then:
            light.turn_on:
              id: livingroomTableLight
              transition_length: 1s
          else:
            light.turn_off:
              id: livingroomTableLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: livingroomTableLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: livingroomTableLight
              - binary_sensor.is_on: livingroomTableLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch63
              then:
                - if:
                    condition:
                      light.is_off: livingroomTableLight
                    then:
                    - light.turn_on:
                        id: livingroomTableLight
                        brightness: 40%  
                - light.dim_relative:
                    id: livingroomTableLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch63
                  - light.is_on: livingroomTableLight
                  - binary_sensor.is_off: livingroomTableLight_dimMin
              then:
              - light.dim_relative:
                  id: livingroomTableLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# kitchenSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "kitchenSwitch_key4"
    id: lightSwitch64
    pin:
      pcf8574: pcf8574_3
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms



# stairsSwitch_key1 controlling stairsCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: stairsCeilingLight_dimMin
    lambda: if (float(id(stairsCeilingLight).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "stairsSwitch_key1"
    id: lightSwitch71
    pin:
      pcf8574: pcf8574_4
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: stairsCeilingLight
          then:
            light.turn_on:
              id: stairsCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: stairsCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: stairsCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: stairsCeilingLight
              - binary_sensor.is_on: stairsCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch71
              then:
                - if:
                    condition:
                      light.is_off: stairsCeilingLight
                    then:
                    - light.turn_on:
                        id: stairsCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: stairsCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch71
                  - light.is_on: stairsCeilingLight
                  - binary_sensor.is_off: stairsCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: stairsCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# stairsSwitch_key2 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "stairsSwitch_key2"
    id: lightSwitch72
    pin:
      pcf8574: pcf8574_4
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# stairsSwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "stairsSwitch_key3"
    id: lightSwitch73
    pin:
      pcf8574: pcf8574_4
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# stairsSwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "stairsSwitch_key4"
    id: lightSwitch74
    pin:
      pcf8574: pcf8574_4
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


# studySwitch_key1 controlling studyCeilingLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: studyCeilingLight_dimMin
    lambda: if (float(id(studyCeilingLight).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "studySwitch_key1"
    id: lightSwitch81
    pin:
      pcf8574: pcf8574_4
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: studyCeilingLight
          then:
            light.turn_on:
              id: studyCeilingLight
              transition_length: 1s
          else:
            light.turn_off:
              id: studyCeilingLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: studyCeilingLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: studyCeilingLight
              - binary_sensor.is_on: studyCeilingLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch81
              then:
                - if:
                    condition:
                      light.is_off: studyCeilingLight
                    then:
                    - light.turn_on:
                        id: studyCeilingLight
                        brightness: 40%  
                - light.dim_relative:
                    id: studyCeilingLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch81
                  - light.is_on: studyCeilingLight
                  - binary_sensor.is_off: studyCeilingLight_dimMin
              then:
              - light.dim_relative:
                  id: studyCeilingLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# studySwitch_key2 controlling studyWallLight
  # set the minimum dimming value to 0.55
  - platform: template
    id: studyWallLight_dimMin
    lambda: if (float(id(studyWallLight).remote_values.get_brightness()) < .55) return true; else return false;

  - platform: gpio
    name: "studySwitch_key2"
    id: lightSwitch82
    pin:
      pcf8574: pcf8574_4
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: studyWallLight
          then:
            light.turn_on:
              id: studyWallLight
              transition_length: 1s
          else:
            light.turn_off:
              id: studyWallLight
              transition_length: 3s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: studyWallLight
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: studyWallLight
              - binary_sensor.is_on: studyWallLight_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                binary_sensor.is_on: lightSwitch82
              then:
                - if:
                    condition:
                      light.is_off: studyWallLight
                    then:
                    - light.turn_on:
                        id: studyWallLight
                        brightness: 40%  
                - light.dim_relative:
                    id: studyWallLight
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: lightSwitch82
                  - light.is_on: studyWallLight
                  - binary_sensor.is_off: studyWallLight_dimMin
              then:
              - light.dim_relative:
                  id: studyWallLight
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

# studySwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "studySwitch_key3"
    id: lightSwitch83
    pin:
      pcf8574: pcf8574_4
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

# studySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "studySwitch_key4"
    id: lightSwitch84
    pin:
      pcf8574: pcf8574_4
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

############################# End of Switch behavior definition #############################