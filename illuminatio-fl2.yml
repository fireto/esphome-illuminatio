### Light controller main
substitutions:
  devicename: fl2_illuminatio
  upperDevicename: Floor2 Lights Controller
  # <<: !include ioMapping.yml
  <<: !include fl2SwitchMapping.yml

esphome:
  name: $devicename
  platform: ESP32
  board: esp32-poe

packages:
  # wifi: !include common/wifi.yml
  ethernet: !include common/ethernet.yml
  api: !include common/api.yml
  ota: !include common/ota.yml
  # mqtt: !include common/mqtt.yml
  logger: !include common/logger.yml
  time: !include common/time.yml
  webserver: !include common/webserver.yml

i2c:
  scan: True

# load module for PCF8574 Remote 8-Bit I/O Expanderfor I2C Bus
# datasheet https://www.ti.com/lit/ds/symlink/pcf8574.pdf
pcf8574:
  - id: 'pcf8574_1'
    address: 0x20
    pcf8575: False

  - id: 'pcf8574_2'
    address: 0x21
    pcf8575: False

  - id: 'pcf8574_3'
    address: 0x22
    pcf8575: False

  - id: 'pcf8574_4'
    address: 0x23
    pcf8575: False

# Individual outputs
switch:
  - platform: restart
    name: $upperDevicename Restart

# Temp sensor
sensor:
  - platform: bmp085
    temperature:
      name: "$upperDevicename enclosure Temperature"
    pressure:
      name: "$upperDevicename enclosure Pressure"
    update_interval: 300s

  # - platform: uptime
  #   name: Uptime Sensor
  #   id: uptime_sensor
  #   update_interval: 60s
  #   internal: true
  #   on_raw_value:
  #     then:
  #       - text_sensor.template.publish:
  #           id: uptime_human
  #           state: !lambda |-
  #             int seconds = round(id(uptime_sensor).raw_state);
  #             int days = seconds / (24 * 3600);
  #             seconds = seconds % (24 * 3600);
  #             int hours = seconds / 3600;
  #             seconds = seconds % 3600;
  #             int minutes = seconds /  60;
  #             seconds = seconds % 60;
  #             return (
  #               (days ? String(days) + "d " : "") +
  #               (hours ? String(hours) + "h " : "") +
  #               (minutes ? String(minutes) + "m " : "") +
  #               (String(seconds) + "s")
  #             ).c_str();

# text_sensor:
#   - platform: template
#     name: $upperDevicename Uptime Human Readable
#     id: uptime_human
#     icon: mdi:clock-start
              
# load module for PCA9685 16-Channel 12-bit PWM/Servo Driver I2C
# datasheet https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf
pca9685:
  - frequency: 500

#Define PCA9685 PWM chnnels and register them as outputs in ESPHome
# pins 0-15 are defined as channel 0-15
output:
  - platform: pca9685
    id: pca1_0
    channel: 0
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_1
    channel: 1
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True    

  - platform: pca9685
    id: pca1_2
    channel: 2
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True
    
  - platform: pca9685
    id: pca1_3
    channel: 3
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_4
    channel: 4
    inverted: True

  - platform: pca9685
    id: pca1_5
    channel: 5
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_6
    channel: 6
    inverted: True

  - platform: pca9685
    id: pca1_7
    channel: 7
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_8
    channel: 8
    inverted: True

  - platform: pca9685
    id: pca1_9
    channel: 9
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_10
    channel: 10
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_11
    channel: 11
    inverted: True

  - platform: pca9685
    id: pca1_12
    channel: 12
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  - platform: pca9685
    id: pca1_13
    channel: 13
    inverted: True
    min_power: 0.3
    max_power: 0.9
    zero_means_zero: True

  #   output: pca1_14 not connected on the PCB
  # - platform: pca9685
  #   id: pca1_14
  #   channel: 14
  #   inverted: True

  - platform: pca9685
    id: pca1_15
    channel: 15

# Define LED drivers as light components for esphome and hass automations
# https://esphome.io/components/light/index.html
light:  
  - platform: monochromatic
    name: "fl2HallwayCeilingLight"
    id: fl2HallwayCeilingLight
    output: pca1_0
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl2BathroomCeilingLight"
    id: fl2BathroomCeilingLight
    output: pca1_1
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl2BathroomShowerLight"
    id: fl2BathroomShowerLight
    output: pca1_2
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl2BathroomBathtubLight"
    id: fl2BathroomBathtubLight
    output: pca1_3
    restore_mode: RESTORE_DEFAULT_OFF
    
  - platform: monochromatic
    name: "fl2BathroomFloorHeating"
    id: fl2BathroomFloorHeating
    output: pca1_4
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom1CeilingLight"
    id: fl2Bedroom1CeilingLight
    output: pca1_5
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom1WallLight"
    id: fl2Bedroom1WallLight
    output: pca1_6
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom2CeilingLight"
    id: fl2Bedroom2CeilingLight
    output: pca1_7
    restore_mode: RESTORE_DEFAULT_OFF
    
  - platform: monochromatic
    name: "fl2Bedroom2WallLight"
    id: fl2Bedroom2WallLight
    output: pca1_8
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom0CeilingLight1"
    id: fl2Bedroom0CeilingLight1
    output: pca1_9
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom0CeilingLight2"
    id: fl2Bedroom0CeilingLight2
    output: pca1_10
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: monochromatic
    name: "fl2Bedroom0WallLight"
    id: fl2Bedroom0WallLight
    output: pca1_11
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom0BedLight1"
    id: fl2Bedroom0BedLight1
    output: pca1_12
    restore_mode: RESTORE_DEFAULT_OFF
        
  - platform: monochromatic
    name: "fl2Bedroom0BedLight2"
    id: fl2Bedroom0BedLight2
    output: pca1_13
    restore_mode: RESTORE_DEFAULT_OFF
    
  #   output: pca1_14 not connected on the PCB

  - platform: monochromatic
    name: $upperDevicename Case Fan
    id: ${devicename}_case_fan
    output: pca1_15
    restore_mode: RESTORE_DEFAULT_OFF


# Define behaviour on lightswitch presses
# for detailed decription check switch_mappings.ods
binary_sensor:

#11 fl2HallwaySwitch_key1 controlling fl2HallwayCeilingLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch11Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch11Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch11Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch11Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2HallwaySwitch_key1"
    id: fl2LightSwitch11
    pin:
      pcf8574: pcf8574_1
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch11Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch11Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch11Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch11Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch11Light}
              - binary_sensor.is_on: ${fl2LightSwitch11Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch11
                  - binary_sensor.is_off: ${fl2LightSwitch11Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch11Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch11Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch11Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch11
                  - light.is_on: ${fl2LightSwitch11Light}
                  - binary_sensor.is_off: ${fl2LightSwitch11Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch11Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#12 fl2HallwaySwitch_key2 controlling fl2HallwayCeilingLight

  - platform: gpio
    name: "fl2HallwaySwitch_key2"
    id: fl2LightSwitch12
    pin:
      pcf8574: pcf8574_1
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch12Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch12Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch12Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch12Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch12Light}
              - binary_sensor.is_on: ${fl2LightSwitch12Light}_dimMin
          then:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch12
                  - binary_sensor.is_off: ${fl2LightSwitch12Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch12Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch12Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch12Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch12
                  - light.is_on: ${fl2LightSwitch12Light}
                  - binary_sensor.is_off: ${fl2LightSwitch12Light}_dimMin
              then:
                - light.dim_relative:
                    id: ${fl2LightSwitch12Light}
                    relative_brightness: -5%
                    transition_length: 0.1s
                - delay: 0.1s

#13 fl2HallwaySwitch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2HallwaySwitch_key3"
    id: fl2LightSwitch13
    pin:
      pcf8574: pcf8574_1
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#14 fl2HallwaySwitch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2HallwaySwitch_key4"
    id: fl2LightSwitch14
    pin:
      pcf8574: pcf8574_1
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#21 fl2BathroomSwitch_key1 controlling fl2BathroomCeilingLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch21Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch21Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch21Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch21Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2BathroomSwitch_key1"
    id: fl2LightSwitch21
    pin:
      pcf8574: pcf8574_1
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch21Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch21Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch21Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch21Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch21Light}
              - binary_sensor.is_on: ${fl2LightSwitch21Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch21
                  - binary_sensor.is_off: ${fl2LightSwitch21Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch21Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch21Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch21Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch21
                  - light.is_on: ${fl2LightSwitch21Light}
                  - binary_sensor.is_off: ${fl2LightSwitch21Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch21Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#22 fl2BathroomSwitch_key2 controlling fl2BathroomShowerLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch22Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch22Light}).remote_values.get_brightness()) < .05) return true; else return false;    

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch22Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch22Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2BathroomSwitch_key2"
    id: fl2LightSwitch22
    pin:
      pcf8574: pcf8574_1
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch22Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch22Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch22Light}
              transition_length: 0s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch22Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch22Light}
              - binary_sensor.is_on: ${fl2LightSwitch22Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch22
                  - binary_sensor.is_off: ${fl2LightSwitch22Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch22Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch22Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch22Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch22
                  - light.is_on: ${fl2LightSwitch22Light}
                  - binary_sensor.is_off: ${fl2LightSwitch22Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch22Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#23 fl2BathroomSwitch_key3 controlling fl2BathroomBathtubLight
  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch23Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch23Light}).remote_values.get_brightness()) < .05) return true; else return false;    

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch23Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch23Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2BathroomSwitch_key3"
    id: fl2LightSwitch23
    pin:
      pcf8574: pcf8574_1
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch23Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch23Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch23Light}
              transition_length: 0s
  # on double click, turno on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch23Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch23Light}
              - binary_sensor.is_on: ${fl2LightSwitch23Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch22
                  - binary_sensor.is_off: ${fl2LightSwitch23Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch23Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch23Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch23Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch22
                  - light.is_on: ${fl2LightSwitch23Light}
                  - binary_sensor.is_off: ${fl2LightSwitch23Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch23Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#24 fl2BathroomSwitch_key4 controlling fl2BathroomFloorHeating
  - platform: gpio
    name: "fl2BathroomSwitch_key4"
    id: fl2LightSwitch24
    pin:
      pcf8574: pcf8574_1
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on press, toggle light
    on_press:
      then:
        light.toggle: 
          id: ${fl2LightSwitch24Light}
          transition_length: 0s


#31 fl2Bedroom1Switch_key1 controlling fl2Bedroom1CeilingLight

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch31Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch31Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch31Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch31Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom1Switch_key1"
    id: fl2LightSwitch31
    pin:
      pcf8574: pcf8574_2
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch31Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch31Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch31Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch31Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch31Light}
              - binary_sensor.is_on: ${fl2LightSwitch31Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch31
                  - binary_sensor.is_off: ${fl2LightSwitch31Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch31Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch31Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch31Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch31
                  - light.is_on: ${fl2LightSwitch31Light}
                  - binary_sensor.is_off: ${fl2LightSwitch31Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch31Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#32 fl2Bedroom1Switch_key2 controlling fl2Bedroom1WallLight

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch32Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch32Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch32Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch32Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom1Switch_key2"
    id: fl2LightSwitch32
    pin:
      pcf8574: pcf8574_2
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch32Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch32Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch32Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch32Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch32Light}
              - binary_sensor.is_on: ${fl2LightSwitch32Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch32
                  - binary_sensor.is_off: ${fl2LightSwitch32Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch32Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch32Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch32Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch32
                  - light.is_on: ${fl2LightSwitch32Light}
                  - binary_sensor.is_off: ${fl2LightSwitch32Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch32Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#33 fl2Bedroom1Switch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom1Switch_key3"
    id: fl2LightSwitch33
    pin:
      pcf8574: pcf8574_2
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#34 fl2Bedroom1Switch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom1Switch_key4"
    id: fl2LightSwitch34
    pin:
      pcf8574: pcf8574_2
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#41 fl2Bedroom2Switch_key1 controlling fl2Bedroom2CeilingLight

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch41Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch41Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch41Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch41Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom2Switch_key1"
    id: fl2LightSwitch41
    pin:
      pcf8574: pcf8574_2
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch41Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch41Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch41Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch41Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch41Light}
              - binary_sensor.is_on: ${fl2LightSwitch41Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch41
                  - binary_sensor.is_off: ${fl2LightSwitch41Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch41Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch41Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch41Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch41
                  - light.is_on: ${fl2LightSwitch41Light}
                  - binary_sensor.is_off: ${fl2LightSwitch41Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch41Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s
  
#42 fl2Bedroom2Switch_key2 controlling fl2Bedroom2WallLight

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch42Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch42Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch42Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch42Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom2Switch_key2"
    id: fl2LightSwitch42
    pin:
      pcf8574: pcf8574_2
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch42Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch42Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch42Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch42Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch42Light}
              - binary_sensor.is_on: ${fl2LightSwitch42Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch42
                  - binary_sensor.is_off: ${fl2LightSwitch42Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch42Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch42Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch42Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch42
                  - light.is_on: ${fl2LightSwitch42Light}
                  - binary_sensor.is_off: ${fl2LightSwitch42Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch42Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#43 fl2Bedroom2Switch_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom2Switch_key3"
    id: fl2LightSwitch43
    pin:
      pcf8574: pcf8574_2
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#44 fl2Bedroom2Switch_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom2Switch_key4"
    id: fl2LightSwitch44
    pin:
      pcf8574: pcf8574_2
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#51 fl2Bedroom0Switch1_key1 controlling fl2Bedroom0CeilingLight1

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch51Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch51Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch51Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch51Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom0Switch1_key1"
    id: fl2LightSwitch51
    pin:
      pcf8574: pcf8574_3
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch51Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch51Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch51Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch51Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch51Light}
              - binary_sensor.is_on: ${fl2LightSwitch51Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch51
                  - binary_sensor.is_off: ${fl2LightSwitch51Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch51Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch51Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch51Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch51
                  - light.is_on: ${fl2LightSwitch51Light}
                  - binary_sensor.is_off: ${fl2LightSwitch51Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch51Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#52 fl2Bedroom0Switch1_key2 controlling fl2Bedroom0CeilingLight2

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch52Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch52Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch52Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch52Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom0Switch1_key2"
    id: fl2LightSwitch52
    pin:
      pcf8574: pcf8574_3
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch52Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch52Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch52Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch52Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch52Light}
              - binary_sensor.is_on: ${fl2LightSwitch52Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch52
                  - binary_sensor.is_off: ${fl2LightSwitch52Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch52Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch52Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch52Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch52
                  - light.is_on: ${fl2LightSwitch52Light}
                  - binary_sensor.is_off: ${fl2LightSwitch52Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch52Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#53 fl2Bedroom0Switch1_key3 controlling fl2Bedroom0WallLight

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch53Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch53Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch53Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch53Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom0Switch1_key3"
    id: fl2LightSwitch53
    pin:
      pcf8574: pcf8574_3
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch53Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch53Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch53Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch53Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch53Light}
              - binary_sensor.is_on: ${fl2LightSwitch53Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch53
                  - binary_sensor.is_off: ${fl2LightSwitch53Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch53Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch53Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch53Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch53
                  - light.is_on: ${fl2LightSwitch53Light}
                  - binary_sensor.is_off: ${fl2LightSwitch53Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch53Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#54 fl2Bedroom0Switch1_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom0Switch1_key4"
    id: fl2LightSwitch54
    pin:
      pcf8574: pcf8574_3
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#61 fl2Bedroom0Switch2_key1 controlling fl2Bedroom0CeilingLight2

  - platform: gpio
    name: "fl2Bedroom0Switch2_key1"
    id: fl2LightSwitch61
    pin:
      pcf8574: pcf8574_3
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch61Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch61Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch61Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch61Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch61Light}
              - binary_sensor.is_on: ${fl2LightSwitch61Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch61
                  - binary_sensor.is_off: ${fl2LightSwitch61Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch61Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch61Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch61Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch61
                  - light.is_on: ${fl2LightSwitch61Light}
                  - binary_sensor.is_off: ${fl2LightSwitch61Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch61Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#62 fl2Bedroom0Switch2_key2 controlling fl2Bedroom0WallLight

  - platform: gpio
    name: "fl2Bedroom0Switch2_key2"
    id: fl2LightSwitch62
    pin:
      pcf8574: pcf8574_3
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch62Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch62Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch62Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch62Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch62Light}
              - binary_sensor.is_on: ${fl2LightSwitch62Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch62
                  - binary_sensor.is_off: ${fl2LightSwitch62Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch62Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch62Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch62Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch62
                  - light.is_on: ${fl2LightSwitch62Light}
                  - binary_sensor.is_off: ${fl2LightSwitch62Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch62Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#63 fl2Bedroom0Switch2_key3 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom0Switch2_key3"
    id: fl2LightSwitch63
    pin:
      pcf8574: pcf8574_3
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms

#64 fl2Bedroom0Switch2_key4 is a meta key and usable only via Home Assistant
  - platform: gpio
    name: "fl2Bedroom0Switch2_key4"
    id: fl2LightSwitch64
    pin:
      pcf8574: pcf8574_3
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms


#71 fl2Bedroom0Switch3_key1 controlling fl2Bedroom0CeilingLight2

  - platform: gpio
    name: "fl2Bedroom0Switch3_key1"
    id: fl2LightSwitch71
    pin:
      pcf8574: pcf8574_4
      number: 0
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch71Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch71Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch71Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch71Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch71Light}
              - binary_sensor.is_on: ${fl2LightSwitch71Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch71
                  - binary_sensor.is_off: ${fl2LightSwitch71Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch71Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch71Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch71Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch71
                  - light.is_on: ${fl2LightSwitch71Light}
                  - binary_sensor.is_off: ${fl2LightSwitch71Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch71Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#72 fl2Bedroom0Switch3_key2 controlling fl2Bedroom0WallLight

  - platform: gpio
    name: "fl2Bedroom0Switch3_key2"
    id: fl2LightSwitch72
    pin:
      pcf8574: pcf8574_4
      number: 1
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch72Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch72Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch72Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch72Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch72Light}
              - binary_sensor.is_on: ${fl2LightSwitch72Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch72
                  - binary_sensor.is_off: ${fl2LightSwitch72Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch72Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch72Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch72Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch72
                  - light.is_on: ${fl2LightSwitch72Light}
                  - binary_sensor.is_off: ${fl2LightSwitch72Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch72Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#73 fl2Bedroom0Switch3_key3 controlling fl2Bedroom0CeilingLight1

  - platform: gpio
    name: "fl2Bedroom0Switch3_key3"
    id: fl2LightSwitch73
    pin:
      pcf8574: pcf8574_4
      number: 2
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch73Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch73Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch73Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch73Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch73Light}
              - binary_sensor.is_on: ${fl2LightSwitch73Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch73
                  - binary_sensor.is_off: ${fl2LightSwitch73Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch73Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch73Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch73Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch73
                  - light.is_on: ${fl2LightSwitch73Light}
                  - binary_sensor.is_off: ${fl2LightSwitch73Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch73Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#74 fl2Bedroom0Switch3_key4 controlling fl2Bedroom0BedLight1

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch74Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch74Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch74Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch74Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom0Switch3_key4"
    id: fl2LightSwitch74
    pin:
      pcf8574: pcf8574_4
      number: 3
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch74Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch74Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch74Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch74Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch74Light}
              - binary_sensor.is_on: ${fl2LightSwitch74Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch74
                  - binary_sensor.is_off: ${fl2LightSwitch74Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch74Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch74Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch74Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch74
                  - light.is_on: ${fl2LightSwitch74Light}
                  - binary_sensor.is_off: ${fl2LightSwitch74Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch74Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s


#81 fl2Bedroom0Switch4_key1 controlling fl2Bedroom0BedLight2

  # set the minimum dimming value to 0.05
  - platform: template
    id: ${fl2LightSwitch81Light}_dimMin
    lambda: if (float(id(${fl2LightSwitch81Light}).remote_values.get_brightness()) < .05) return true; else return false;

  # set the maximum dimming value to 1
  - platform: template
    id: ${fl2LightSwitch81Light}_dimMax
    lambda: if (float(id(${fl2LightSwitch81Light}).remote_values.get_brightness()) >= 1) return true; else return false;

  - platform: gpio
    name: "fl2Bedroom0Switch4_key1"
    id: fl2LightSwitch81
    pin:
      pcf8574: pcf8574_4
      number: 4
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch81Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch81Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch81Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch81Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch81Light}
              - binary_sensor.is_on: ${fl2LightSwitch81Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch81
                  - binary_sensor.is_off: ${fl2LightSwitch81Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch81Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch81Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch81Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch81
                  - light.is_on: ${fl2LightSwitch81Light}
                  - binary_sensor.is_off: ${fl2LightSwitch81Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch81Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#82 fl2Bedroom0Switch4_key2 controlling fl2Bedroom0CeilingLight1

  - platform: gpio
    name: "fl2Bedroom0Switch4_key2"
    id: fl2LightSwitch82
    pin:
      pcf8574: pcf8574_4
      number: 5
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch82Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch82Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch82Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch82Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch82Light}
              - binary_sensor.is_on: ${fl2LightSwitch82Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch82
                  - binary_sensor.is_off: ${fl2LightSwitch82Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch82Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch82Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch82Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch82
                  - light.is_on: ${fl2LightSwitch82Light}
                  - binary_sensor.is_off: ${fl2LightSwitch82Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch82Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#83 fl2Bedroom0Switch4_key3 controlling fl2Bedroom0WallLight

  - platform: gpio
    name: "fl2Bedroom0Switch4_key3"
    id: fl2LightSwitch83
    pin:
      pcf8574: pcf8574_4
      number: 6
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch83Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch83Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch83Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch83Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch83Light}
              - binary_sensor.is_on: ${fl2LightSwitch83Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch83
                  - binary_sensor.is_off: ${fl2LightSwitch83Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch83Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch83Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch83Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch83
                  - light.is_on: ${fl2LightSwitch83Light}
                  - binary_sensor.is_off: ${fl2LightSwitch83Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch83Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s

#84 fl2Bedroom0Switch4_key4 controlling fl2Bedroom0CeilingLight2

  - platform: gpio
    name: "fl2Bedroom0Switch4_key4"
    id: fl2LightSwitch84
    pin:
      pcf8574: pcf8574_4
      number: 7
      mode: INPUT
      inverted: True
    filters:
      - delayed_on_off: 30ms
  # on single click, toggle light
    on_click:
      then:
      - if:
          condition:
            light.is_off: ${fl2LightSwitch84Light}
          then:
            light.turn_on:
              id: ${fl2LightSwitch84Light}
              transition_length: 0s
          else:
            light.turn_off:
              id: ${fl2LightSwitch84Light}
              transition_length: 0s
  # on double click, turn on ligh with brighness 100%
    on_multi_click:
    - timing:
        - ON for at most 0.5s
        - OFF for at most 1s
        - ON for at most 0.5s
        - OFF for at least 0.1s
      then:
        light.turn_on: 
          id: ${fl2LightSwitch84Light}
          brightness: 100%
          transition_length: 0s
  # on press, dimm up or down   
    on_press:
      then:
      - if:
          condition:
            or:
              - light.is_off: ${fl2LightSwitch84Light}
              - binary_sensor.is_on: ${fl2LightSwitch84Light}_dimMin
          then:
          - delay: 0.5s         
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch84
                  - binary_sensor.is_off: ${fl2LightSwitch84Light}_dimMax
              then:
                - if:
                    condition:
                      light.is_off: ${fl2LightSwitch84Light}
                    then:
                    - light.turn_on:
                        id: ${fl2LightSwitch84Light}
                        brightness: 5%  
                - light.dim_relative:
                    id: ${fl2LightSwitch84Light}
                    relative_brightness: 5%
                    transition_length: 0.1s
                - delay: 0.1s
          else:
          - delay: 0.5s
          - while:
              condition:
                and:
                  - binary_sensor.is_on: fl2LightSwitch84
                  - light.is_on: ${fl2LightSwitch84Light}
                  - binary_sensor.is_off: ${fl2LightSwitch84Light}_dimMin
              then:
              - light.dim_relative:
                  id: ${fl2LightSwitch84Light}
                  relative_brightness: -5%
                  transition_length: 0.1s
              - delay: 0.1s


############################# End of Switch behavior definition #############################
